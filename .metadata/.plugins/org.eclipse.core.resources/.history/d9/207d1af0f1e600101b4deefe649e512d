package com.example.samuraitravel.service;

import org.springframework.stereotype.Service;

import com.example.samuraitravel.entity.Favorite;
import com.example.samuraitravel.entity.House;
import com.example.samuraitravel.entity.User;
import com.example.samuraitravel.repository.FavoriteRepository;
import com.example.samuraitravel.repository.HouseRepository;
import com.example.samuraitravel.repository.UserRepository;

@Service
public class FavoriteService {

	private final FavoriteRepository favoriteRepository;
	private final UserRepository userRepository;
	private final HouseRepository houseRepository;

	public FavoriteService(FavoriteRepository favoriteRepository,
			UserRepository userRepository,
			HouseRepository houseRepository) {
		this.favoriteRepository = favoriteRepository;
		this.userRepository = userRepository;
		this.houseRepository = houseRepository;
	}

	// お気に入り済みか確認
	public boolean isFavorite(Integer userId, Integer houseId) {
		return favoriteRepository.existsByUserIdAndHouseId(userId, houseId);
	}

	// お気に入り登録
	@Transactional // お気に入り登録には@Transactionalは必要
	public void add(Integer userId, Integer houseId) {
		if (isFavorite(userId, houseId)) {
			return; // 二重に登録を防止
		}

		User user = userRepository.getReferenceById(userId);
		House house = houseRepository.getReferenceById(houseId);

		Favorite favorite = new Favorite();
		favorite.setUserId(userId);
		favorite.setHouseId(houseId);
		favoriteRepository.save(favorite);
	}

	// お気に入り解除
	public void remove(Integer userId, Integer houseId) {
		favoriteRepository.deleteByUserIdAndHouseId(userId, houseId);

	}
}
